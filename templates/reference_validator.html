<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference Validator - Research System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #f8fafc;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin: 2rem auto;
            max-width: 1200px;
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e40af 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .nav-pills {
            background: var(--light-bg);
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .nav-pills .nav-link {
            border-radius: 12px;
            font-weight: 500;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }

        .nav-pills .nav-link:hover {
            background: var(--primary-color);
            color: white;
        }

        .content-section {
            padding: 2rem;
        }

        .upload-card {
            background: var(--light-bg);
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 2rem;
        }

        .upload-card:hover {
            border-color: var(--primary-color);
            background: #eff6ff;
        }

        .upload-card.dragover {
            border-color: var(--primary-color);
            background: #dbeafe;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .format-selector {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .format-option {
            background: var(--light-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .format-option:hover {
            border-color: var(--primary-color);
            background: #eff6ff;
        }

        .format-option.active {
            border-color: var(--primary-color);
            background: #dbeafe;
        }

        .options-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .custom-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .custom-switch:last-child {
            border-bottom: none;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .validate-btn {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 1rem 2rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .validate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }

        .validate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }

        .results-section {
            display: none;
            margin-top: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--secondary-color);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .result-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }

        .correction-item {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .correction-summary {
            background: #fff7ed;
            border: 1px solid #fb923c;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .correction-toggle {
            background: #f97316;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .correction-toggle:hover {
            background: #ea580c;
            transform: translateY(-1px);
        }

        .correction-details {
            display: none;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #fed7aa;
        }

        .correction-details.show {
            display: block;
        }

        .correction-detail-item {
            background: #fef3c7;
            border-left: 3px solid #f59e0b;
            padding: 0.5rem 0.75rem;
            margin: 0.25rem 0;
            font-size: 0.85rem;
            border-radius: 4px;
        }

        .issue-item {
            background: #fee2e2;
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .output-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .output-textarea {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #f9fafb;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            padding: 1rem;
            resize: vertical;
            width: 100%;
        }

        .download-section {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .download-btn {
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 1rem;
                border-radius: 16px;
            }
            
            .content-section {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .download-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-section">
            <h1><i class="fas fa-check-double"></i> Reference Validator</h1>
            <p>Validate, correct, and enhance your academic references with AI-powered verification</p>
        </div>

        <!-- Navigation -->
        <div class="nav-pills">
            <ul class="nav nav-pills justify-content-center">
                <li class="nav-item">
                    <a class="nav-link" href="/"><i class="fas fa-home"></i> Research System</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/literature"><i class="fas fa-book"></i> Literature Builder</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/validator"><i class="fas fa-check-double"></i> Reference Validator</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/citations"><i class="fas fa-quote-right"></i> Citations</a>
                </li>
            </ul>
        </div>

        <!-- Content -->
        <div class="content-section">
            <!-- Upload Section -->
            <div class="upload-card" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4>Drop your reference file here</h4>
                <p class="text-muted">or click to browse files</p>
                <input type="file" id="fileInput" class="d-none" accept=".txt,.bib,.tex">
                <button type="button" class="btn btn-outline-primary mt-2" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-folder-open"></i> Browse Files
                </button>
            </div>

            <!-- Manual Input -->
            <div class="mb-4">
                <label for="manualInput" class="form-label fw-bold">Or paste your references directly:</label>
                <textarea class="form-control" id="manualInput" rows="6" 
                          placeholder="Paste your references here..."></textarea>
            </div>

            <!-- Format Selection -->
            <div class="format-selector">
                <h5 class="mb-3"><i class="fas fa-cog"></i> Reference Format</h5>
                <div class="row">
                    <div class="col-md-4">
                        <div class="format-option active" data-format="bibitem">
                            <h6><strong>Bibitem</strong></h6>
                            <small class="text-muted">\\bibitem{key} format</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="format-option" data-format="bibtex">
                            <h6><strong>BibTeX</strong></h6>
                            <small class="text-muted">@article{key, ...}</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="format-option" data-format="plain">
                            <h6><strong>Plain Text</strong></h6>
                            <small class="text-muted">One reference per line</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Validation Options -->
            <div class="options-card">
                <h5 class="mb-3"><i class="fas fa-tools"></i> Validation Options</h5>
                
                <div class="custom-switch">
                    <div>
                        <strong>Fix Format Issues</strong>
                        <br><small class="text-muted">Correct author names, title capitalization, journal formatting</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="checkFormat" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="custom-switch">
                    <div>
                        <strong>Correct Spelling</strong>
                        <br><small class="text-muted">Fix common spelling mistakes in academic terms</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="checkSpelling" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="custom-switch">
                    <div>
                        <strong>Remove Duplicates</strong>
                        <br><small class="text-muted">Detect and remove duplicate references intelligently</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="checkDuplicates" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="custom-switch">
                    <div>
                        <strong>Verify Papers</strong>
                        <br><small class="text-muted">Validate papers using CrossRef API and correct bibliographic data</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="verifyPapers" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Validate Button -->
            <button type="button" class="validate-btn" id="validateBtn" disabled>
                <i class="fas fa-check-double"></i> Validate References
            </button>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Validating references...</span>
                </div>
                <p class="mt-3">Processing references, please wait...</p>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <!-- Statistics -->
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated here -->
                </div>

                <!-- Processing Log -->
                <div class="result-card">
                    <div class="result-header">
                        <i class="fas fa-list result-icon text-info"></i>
                        <h5>Processing Log</h5>
                    </div>
                    <div id="processingLog">
                        <!-- Log will be populated here -->
                    </div>
                </div>

                <!-- Corrections and Issues -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-header">
                                <i class="fas fa-edit result-icon text-warning"></i>
                                <h5>Corrections Made</h5>
                            </div>
                            <div id="correctionsSection">
                                <!-- Corrections will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-header">
                                <i class="fas fa-exclamation-triangle result-icon text-danger"></i>
                                <h5>Issues Found</h5>
                            </div>
                            <div id="issuesSection">
                                <!-- Issues will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="output-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-white mb-0"><i class="fas fa-file-alt"></i> Corrected References</h5>
                        <select class="form-select" id="outputFormat" style="width: auto;">
                            <option value="bibitem">Bibitem Format</option>
                            <option value="bibtex">BibTeX Format</option>
                            <option value="plain">Plain Text Format</option>
                        </select>
                    </div>
                    <textarea class="output-textarea" id="correctedReferences" rows="15" readonly></textarea>
                    
                    <div class="download-section">
                        <button class="download-btn" onclick="downloadCorrectedReferences()">
                            <i class="fas fa-download"></i> Download References
                        </button>
                        <button class="download-btn" onclick="downloadValidationReport()">
                            <i class="fas fa-file-text"></i> Download Report
                        </button>
                        <button class="download-btn" onclick="copyToClipboard()">
                            <i class="fas fa-copy"></i> Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let validationResult = null;
        let fileContent = '';
        let selectedFormat = 'bibitem';

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const manualInput = document.getElementById('manualInput');
        const validateBtn = document.getElementById('validateBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultsSection = document.getElementById('resultsSection');

        // File upload handling
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        uploadArea.addEventListener('dragleave', handleDragLeave);

        fileInput.addEventListener('change', handleFileSelect);
        manualInput.addEventListener('input', handleManualInput);

        // Format selection
        document.querySelectorAll('.format-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                selectedFormat = this.dataset.format;
            });
        });

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function handleManualInput(e) {
            fileContent = e.target.value;
            validateBtn.disabled = !fileContent.trim();
        }

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                fileContent = e.target.result;
                manualInput.value = fileContent;
                validateBtn.disabled = false;
                
                // Update upload area
                uploadArea.innerHTML = `
                    <div class="upload-icon text-success">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h5>${file.name}</h5>
                    <p class="text-success">File loaded successfully</p>
                `;
            };
            reader.readAsText(file);
        }

        // Validation process
        validateBtn.addEventListener('click', async function() {
            if (!fileContent.trim()) {
                alert('Please upload a file or paste references manually.');
                return;
            }

            const options = {
                checkFormat: document.getElementById('checkFormat').checked,
                checkSpelling: document.getElementById('checkSpelling').checked,
                checkDuplicates: document.getElementById('checkDuplicates').checked,
                verifyPapers: document.getElementById('verifyPapers').checked
            };

            // Show loading
            loadingSpinner.style.display = 'block';
            resultsSection.style.display = 'none';
            validateBtn.disabled = true;

            try {
                const response = await fetch('/validate-references', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: fileContent,
                        format: selectedFormat,
                        options: options
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    validationResult = data;
                    displayResults(data);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                loadingSpinner.style.display = 'none';
                validateBtn.disabled = false;
            }
        });

        function displayResults(data) {
            resultsSection.style.display = 'block';
            
            displayStatistics(data.stats);
            displayProcessingLog(data.processing_log);
            displayCorrections(data.corrections);
            displayIssues(data.issues);
            displayCorrectedReferences(data.corrected_references);
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function displayStatistics(stats) {
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-number text-primary">${stats.original_count}</div>
                    <div class="stat-label">Original</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-warning">${stats.duplicates_removed}</div>
                    <div class="stat-label">Duplicates</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-info">${stats.format_corrections}</div>
                    <div class="stat-label">Format Fixes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-success">${stats.spelling_corrections}</div>
                    <div class="stat-label">Spelling Fixes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-danger">${stats.invalid_papers}</div>
                    <div class="stat-label">Invalid</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number text-success">${stats.final_count}</div>
                    <div class="stat-label">Final Valid</div>
                </div>
            `;
            document.getElementById('statsGrid').innerHTML = statsHtml;
        }

        function displayProcessingLog(log) {
            const logHtml = log.map(entry => `<div class="mb-1">â€¢ ${entry}</div>`).join('');
            document.getElementById('processingLog').innerHTML = logHtml;
        }

        function displayCorrections(corrections) {
            if (corrections.length === 0) {
                document.getElementById('correctionsSection').innerHTML = '<p class="text-muted">No corrections needed.</p>';
                return;
            }

            const totalCorrections = corrections.reduce((sum, corr) => sum + (corr.corrections_count || 0), 0);
            
            const correctionsHtml = `
                <div class="text-center">
                    <div class="mb-3">
                        <h4 class="text-warning">${totalCorrections}</h4>
                        <p class="text-muted">Total corrections made across ${corrections.length} references</p>
                    </div>
                    <button class="btn btn-warning btn-lg" onclick="viewCorrectionsDetails()">
                        <i class="fas fa-eye"></i> View All Corrections
                    </button>
                </div>
            `;
            
            document.getElementById('correctionsSection').innerHTML = correctionsHtml;
            
            // Store corrections data for the details page
            window.correctionsData = corrections;
        }

        function viewCorrectionsDetails() {
            if (window.correctionsData) {
                const dataParam = encodeURIComponent(JSON.stringify(window.correctionsData));
                window.open(`/corrections-details?data=${dataParam}`, '_blank');
            }
        }

        function displayIssues(issues) {
            if (issues.length === 0) {
                document.getElementById('issuesSection').innerHTML = '<p class="text-muted">No issues found.</p>';
                return;
            }

            const issuesHtml = issues.map((issue, index) => {
                const issueId = `issue-${index}`;
                return `
                    <div class="correction-summary" style="background: #fef2f2; border-color: #fca5a5;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${issue.type}:</strong> ${issue.reference_key}
                                <br><small class="text-muted">${issue.description.split(';').length} issues found</small>
                            </div>
                            <button class="correction-toggle" style="background: #ef4444;" onclick="toggleCorrections('${issueId}')">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                        </div>
                        <div class="correction-details" id="${issueId}">
                            ${issue.description.split(';').map(desc => `
                                <div class="correction-detail-item" style="background: #fee2e2; border-color: #fca5a5;">
                                    ${desc.trim()}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('issuesSection').innerHTML = issuesHtml;
        }

        function displayCorrectedReferences(references) {
            document.getElementById('correctedReferences').value = references;
        }

        // Output format change
        document.getElementById('outputFormat').addEventListener('change', function() {
            if (validationResult) {
                const format = this.value;
                fetch('/reformat-references', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        references: validationResult.corrected_references_data,
                        format: format
                    })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('correctedReferences').value = data.formatted_references;
                })
                .catch(error => console.error('Error reformatting:', error));
            }
        });

        // Download functions
        function downloadCorrectedReferences() {
            if (!validationResult) return;
            
            const format = document.getElementById('outputFormat').value;
            const content = document.getElementById('correctedReferences').value;
            const filename = `corrected_references.${format === 'bibtex' ? 'bib' : 'txt'}`;
            
            downloadFile(content, filename, 'text/plain');
        }

        function downloadValidationReport() {
            if (!validationResult) return;
            
            downloadFile(validationResult.validation_report, 'validation_report.md', 'text/markdown');
        }

        function copyToClipboard() {
            const textarea = document.getElementById('correctedReferences');
            textarea.select();
            document.execCommand('copy');
            
            // Show feedback
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>